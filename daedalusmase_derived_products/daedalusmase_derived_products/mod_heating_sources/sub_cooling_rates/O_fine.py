"""
**sub_Heating_Sources.O_fine**

**Description**:
_____________________________________________________________________________________________________________________

Calculate cooling due to O fine structure
_____________________________________________________________________________________________________________________
_____________________________________________________________________________________________________________________

**Inputs**:
_____________________________________________________________________________________________________________________

`Necm`: electron density in \(cm^{-3}\)

`NO`: \(O\) density in \(cm^{-3}\)

`Te`: electron temperature in K

`Tn`: neutral temperature in K
_____________________________________________________________________________________________________________________
_______________________________________________________________________________________________________________________

**Outputs**:
_____________________________________________________________________________________________________________________

`Le_O_finef_schunk`: Accorsing to Schunk and Nagy [2009] 

`Le_O_finef_rees`: According to Rees [1989]

`Le_O_finef_tiegcm`: According to TIEGCM formulas
_____________________________________________________________________________________________________________________
________________________________________________________________________________________________________________________

**Reference**:
_____________________________________________________________________________________________________________________

Schunk, R. and Nagy, A. (2009). Ionospheres: physics, plasma physics, and chemistry (Cambridge
university press)

Rees, M. H. (1989). Physics and chemistry of the upper atmosphere. Cambridge University Press.
______________________________________________________________________________________________________________________
________________________________________________________________________________________________________________________

"""
import numpy as np

def O_fine(Necm,NO,Te,Tn):
    #Schunk and Nagy
    D=5+np.exp(-326.6/Tn)+3*np.exp(-227.7/Tn)
    S21=1.863*10**(-11)
    S20=1.191*10**(-11)
    S10=8.249*10**(-16)*Te**(0.6)*np.exp(-227.7/Tn)

    Le_O_finef_schunk=(((Necm*NO)/D)*((S10*(1-np.exp(98.9*(1/Te-1/Tn)))) \
                               +S20*(1-np.exp(326.6*(1/Te-1/Tn))) \
                               +S21*(1-np.exp(227.7*(1/Te-1/Tn)))))*1.60217662*10**(-13) #W/m^3    
    #tiegcm
    Le_O_finef_tiegcm=3.4*10**(-12)*((1-7*10**(-5)*Te)/Tn)*(150/Te+0.4)*1.60217662*10**(-13) #W/m^3 
        #Rees and Roble
    A_5_r=8.63*10**(-5)*Te
    A_6_r=8.63*10**(-5)*Tn
    A_7_r=3.4*10**(-12)*Tn**(-1)*(Te-Tn)*(1-7*10**(-5)*Te)
    A_1_r=3*10**10*np.sqrt(Te)*((5+3*np.exp(-0.02/A_6_r)+np.exp(-0.028/A_6_r)))**(-1)
    A_2_r=0.02*(4.75*10**(-21)*Te+6.82*10**(-17))*(np.exp(-0.02/A_5_r)-np.exp(-0.02/A_6_r))
    A_3_r=0.028*(2.3*10**(-21)*Te+1.16*10**(-17))*(np.exp(-0.028/A_5_r)-np.exp(-0.028/A_6_r))
    A_4_r=8*10**(-3)*(3*10**(-21)+2.2*10**(-17))*(np.exp(-(8*10**(-3))/A_5_r)-np.exp((8*10**(-3))/A_6_r))
    
    Tdiff=Te-Tn
    if Tdiff<=3000:
        Bstar=A_1_r*(A_2_r+A_3_r+A_4_r)*A_5_r
    else:
        Bstar=0.5*((A_1_r*(A_2_r+A_3_r+A_4_r)*A_5_r)+A_7_r)
        
    Le_O_finef_rees=Necm*NO*Bstar*1.60217662*10**(-13) #W/m^3
    
    return Le_O_finef_schunk,Le_O_finef_rees,Le_O_finef_tiegcm