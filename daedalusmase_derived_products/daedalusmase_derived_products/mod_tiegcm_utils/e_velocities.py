"""
sub_Heating_Sources.e_velocities

**Description**:
_____________________________________________________________________________________________________________________

Calculate e velocity by solving the coresponding momentum equation
_____________________________________________________________________________________________________________________
_____________________________________________________________________________________________________________________

**Inputs**:
_____________________________________________________________________________________________________________________

ven:

omega_e:

Estar:

B_enu: magnetic field vector in ENU

Un: Neutral velocity in m/s [ENU]

_____________________________________________________________________________________________________________________
_______________________________________________________________________________________________________________________

**Outputs**:
_____________________________________________________________________________________________________________________

ve_starx:

ve_stary:

ve_starz:

ve_starmag:
_____________________________________________________________________________________________________________________
________________________________________________________________________________________________________________________

**Reference**:
_____________________________________________________________________________________________________________________

______________________________________________________________________________________________________________________
________________________________________________________________________________________________________________________

"""

import numpy as np

def e_velocities(ven,omega_e,Estar,B_enu,Un):
    
    bnorm=np.sqrt(B_enu[0]*B_enu[0]+B_enu[1]*B_enu[1]+B_enu[2]*B_enu[2])
    b_unit=[B_enu[0]/bnorm,B_enu[1]/bnorm,B_enu[2]/bnorm]
    ve_star=(-ven*omega_e*Estar+omega_e**2*(np.cross(Estar,b_unit)))/(bnorm*(ven**2+omega_e**2))
    ve_starx=ve_star[0] #m/s
    ve_stary=ve_star[1] #m/s
    ve_starz=ve_star[2] #m/s
    ve_starmag=np.sqrt(ve_star[0] * ve_star[0] + ve_star[1] * ve_star[1] + ve_star[2] * ve_star[2])

    Unvert=np.cross(Un,b_unit)

    ve_xtemp=ve_starx+Unvert[0] #from neutral frame to ENU
    ve_ytemp=ve_stary+Unvert[1] #from neutral frame to ENU
    ve_ztemp=ve_starz+Unvert[2] #from neutral frame to ENU

    return ve_starx,ve_stary,ve_starz,ve_starmag

