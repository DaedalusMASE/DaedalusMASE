"""
sub_Heating_Sources.igrf_B

**Description**:
_____________________________________________________________________________________________________________________

Calculate IGRF-12 magnetic field in ENU and ECEF
_____________________________________________________________________________________________________________________
_____________________________________________________________________________________________________________________

**Inputs**:
_____________________________________________________________________________________________________________________

`time_p`: time (datetime object) 

`lat_p`: latitude in \(deg\) 

`lon_p`: longitude in \(deg\)

`alt_p`: altitude in \(km\)
_____________________________________________________________________________________________________________________
_______________________________________________________________________________________________________________________

**Outputs**:
_____________________________________________________________________________________________________________________

`B_enu`: Magnetic field vector in \(T\) [ENU]

`b_unit_enu`: Magnetic field unit vector [ENU]
_____________________________________________________________________________________________________________________
________________________________________________________________________________________________________________________

**Reference**:
_____________________________________________________________________________________________________________________

______________________________________________________________________________________________________________________
________________________________________________________________________________________________________________________

"""

import numpy as np
import igrf12

def igrf_B(time_p, lat_p, lon_p, alt_p):    
    mag=igrf12.igrf(time_p,lat_p,lon_p,alt_p)
    Be = mag.east.values[0]/10**9
    Bn = mag.north.values[0]/10**9
    Bu = -mag.down.values[0]/10**9
    B_enu = [Be, Bn, Bu]  # vector of magnetic field ENU in Telsa
    

    bnorm = np.sqrt(Be * Be + Bn * Bn + Bu * Bu)
    b_unit_enu = [Be / bnorm, Bn / bnorm, Bu / bnorm]

    return B_enu,b_unit_enu


